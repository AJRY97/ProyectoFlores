<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>Para ti 💛</title>
    <meta name="theme-color" content="#ffdf47" />
    <style>
        :root {
            --bg1: #fff8d6;
            --bg2: #ffe56b;
            --ink: #2b2b2b;
            --sun: #ffd23f;
            --petal: #ffcf33;
            --petal2: #ffc107;
            --leaf: #3fbf6f;
            --stem: #2aa35e;
            --heart: #ff6b81;
            --shadow: 0 10px 30px rgba(0, 0, 0, .12);
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;
            color: var(--ink);
            background: radial-gradient(1200px 800px at 50% -10%, var(--bg2), var(--bg1));
            overflow: hidden;
        }

        .wrap {
            position: relative;
            height: 100%;
            width: 100%;
            display: grid;
            place-items: center;
        }

        .card {
            width: min(92vw, 640px);
            border-radius: 28px;
            background: #fff;
            box-shadow: var(--shadow);
            padding: 24px 20px 28px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transform: translateY(10px);
            animation: rise .8s ease-out forwards;
        }

        @keyframes rise {
            to {
                transform: translateY(0)
            }
        }

        .tag {
            font-size: 12px;
            letter-spacing: .12em;
            text-transform: uppercase;
            color: #8c8c8c
        }

        h1 {
            margin: .35em 0 .1em;
            font-size: clamp(24px, 5vw, 32px)
        }

        p {
            margin: .5em 0;
            line-height: 1.5
        }

        .btn {
            display: inline-grid;
            place-items: center;
            margin: 16px auto 8px;
            padding: 14px 18px;
            border: none;
            border-radius: 14px;
            background: linear-gradient(180deg, #ffe46b, var(--sun));
            color: #3a3300;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 6px 16px rgba(255, 210, 55, .5);
            cursor: pointer;
            transition: transform .1s;
        }

        .btn:active {
            transform: translateY(1px) scale(.99)
        }

        .hint {
            font-size: 12px;
            color: #7a7a7a
        }

        /* === Campo === */
        .stage {
            position: relative;
            width: 100%;
            height: 360px;
            display: grid;
            place-items: center;
            margin-top: 10px;
            border-radius: 16px;
            overflow: hidden;
        }

        #field {
            width: 100%;
            height: 100%
        }

        .fade-in {
            opacity: 0;
            transform: translateY(6px);
            animation: fi .8s ease forwards
        }

        @keyframes fi {
            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .fade-out {
            animation: fo .6s ease forwards
        }

        @keyframes fo {
            to {
                opacity: 0;
                transform: scale(.98)
            }
        }

        /* Mensaje */
        .msg {
            margin: 12px auto 0;
            max-width: 34ch;
            opacity: 0;
            transform: translateY(6px);
            transition: opacity .6s, transform .6s;
            font-size: 15px
        }

        .msg.show {
            opacity: 1;
            transform: translateY(0)
        }

        /* Confeti de pétalos */
        .petal {
            position: fixed;
            top: -10vh;
            width: 12px;
            height: 12px;
            border-radius: 50% 50% 40% 60%/60% 40% 60% 40%;
            background: var(--petal);
            box-shadow: inset -2px -2px 0 rgba(0, 0, 0, .08);
            opacity: .95;
            pointer-events: none
        }

        @keyframes fall {
            to {
                transform: translateY(110vh) rotate(360deg);
                opacity: .95
            }
        }

        @keyframes spin {
            0% {
                filter: hue-rotate(0)
            }

            100% {
                filter: hue-rotate(15deg)
            }
        }

        /* Corazón flotante */
        .heart {
            position: absolute;
            font-size: 14px;
            opacity: 0;
            animation: floatUp 2.2s ease-in forwards
        }

        @keyframes floatUp {
            0% {
                transform: translateY(8px) scale(.8);
                opacity: 0
            }

            15% {
                opacity: 1
            }

            100% {
                transform: translateY(-60px) scale(1.3);
                opacity: 0
            }
        }

        /* --- SOLO CABEZAS EN CORAZÓN (con safe padding para sombra) --- */
        :root {
            /* ajusta estos si quieres más aire */
            --heads-safe: 28px;
            /* arriba/izq/der */
            --heads-safe-bottom: 68px;
            /* abajo (por el botón) */
        }

        #heads {
            position: absolute;
            left: var(--heads-safe);
            right: var(--heads-safe);
            top: var(--heads-safe);
            bottom: var(--heads-safe-bottom);
            pointer-events: none;
            opacity: 0;
        }

        #heads.show {
            animation: headsIn .6s ease forwards .15s
        }

        @keyframes headsIn {
            to {
                opacity: 1
            }
        }

        /* cada cabeza con sombra propia */
        .headWrap {
            position: absolute;
            width: 72px;
            height: 72px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(.2) rotate(-25deg);
            opacity: 0;
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, .18));
            transition:
                left .9s cubic-bezier(.2, 1, .2, 1),
                top .9s cubic-bezier(.2, 1, .2, 1),
                transform .9s cubic-bezier(.2, 1, .2, 1),
                opacity .6s ease;
        }

        .headWrap.pop {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1) rotate(0)
        }

        .headWrap:nth-child(odd) {
            transition-delay: .05s
        }

        .headWrap:nth-child(3n) {
            transition-delay: .12s
        }

        /* Giro completo y continuo SOLO al <svg> interno */
        .headSpin {
            animation: spinFull var(--spinDur, 14s) linear infinite
        }

        @keyframes spinFull {
            to {
                transform: rotate(360deg)
            }
        }

        /* ---- Botón de sonido bonito ---- */
        .sound {
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 2;
            border: none;
            border-radius: 999px;
            padding: 10px 14px;
            gap: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            color: #3a3300;
            background: linear-gradient(180deg, #fff8d6, #ffe46b);
            box-shadow: 0 8px 18px rgba(0, 0, 0, .12), inset 0 1px 0 rgba(255, 255, 255, .6);
            cursor: pointer;
            transition: transform .08s ease, box-shadow .2s ease;
        }

        .sound:active {
            transform: translateY(1px)
        }

        .sound .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--petal2);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, .06) inset;
        }

        .sound[aria-pressed="false"] {
            background: linear-gradient(180deg, #fff, #ffeaa5);
        }

        .sound[aria-pressed="false"] .dot {
            background: #bbb;
        }

        /* Responsive */
        @media (max-width:420px) {
            .stage {
                height: 320px
            }

            .sound {
                top: 10px;
                right: 10px;
                padding: 9px 12px
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="card" id="card">
            <div class="tag">💛 Feliz Primavera wawita 💛</div>
            <p class="hint">Toca el botón para abrir tu sorpresa</p>

            <div class="stage" id="stage">
                <!-- Campo que llena toda la tarjeta -->
                <svg id="field" class="fade-in" viewBox="0 0 360 220" preserveAspectRatio="none" role="img"
                    aria-label="Campo de girasoles">
                    <defs>
                        <!-- Pétalo estilo flat -->
                        <path id="petalo" d="M0 -22 C7 -18 10 -9 0 -3 C-10 -9 -7 -18 0 -22 Z" />

                        <!-- Cabeza (dos coronas + centro plano) -->
                        <g id="sunflowerHead">
                            <g fill="var(--petal)">
                                <use href="#petalo" transform="rotate(0)" />
                                <use href="#petalo" transform="rotate(30)" />
                                <use href="#petalo" transform="rotate(60)" />
                                <use href="#petalo" transform="rotate(90)" />
                                <use href="#petalo" transform="rotate(120)" />
                                <use href="#petalo" transform="rotate(150)" />
                                <use href="#petalo" transform="rotate(180)" />
                                <use href="#petalo" transform="rotate(210)" />
                                <use href="#petalo" transform="rotate(240)" />
                                <use href="#petalo" transform="rotate(270)" />
                                <use href="#petalo" transform="rotate(300)" />
                                <use href="#petalo" transform="rotate(330)" />
                            </g>
                            <g fill="var(--petal2)" transform="scale(.9)">
                                <use href="#petalo" transform="rotate(15)" />
                                <use href="#petalo" transform="rotate(45)" />
                                <use href="#petalo" transform="rotate(75)" />
                                <use href="#petalo" transform="rotate(105)" />
                                <use href="#petalo" transform="rotate(135)" />
                                <use href="#petalo" transform="rotate(165)" />
                                <use href="#petalo" transform="rotate(195)" />
                                <use href="#petalo" transform="rotate(225)" />
                                <use href="#petalo" transform="rotate(255)" />
                                <use href="#petalo" transform="rotate(285)" />
                                <use href="#petalo" transform="rotate(315)" />
                                <use href="#petalo" transform="rotate(345)" />
                            </g>
                            <circle r="16" fill="#c26a19" />
                            <circle r="11" fill="#8a4a10" />
                        </g>

                        <!-- Flor completa (tallo + hojas + cabeza) -->
                        <g id="sunflower">
                            <path d="M0,0 C 2,28 2,56 0,100" stroke="var(--stem)" stroke-width="6" fill="none"
                                stroke-linecap="round" />
                            <g fill="var(--leaf)">
                                <ellipse cx="-10" cy="45" rx="9" ry="17" transform="rotate(-18 -10 45)" />
                                <ellipse cx="12" cy="68" rx="9" ry="17" transform="rotate(18 12 68)" />
                                <ellipse cx="-8" cy="70" rx="8" ry="15" transform="rotate(-10 -8 70)" />
                            </g>

                            <g id="head" transform="translate(0,-6)">
                                <use href="#sunflowerHead" />
                            </g>
                        </g>

                        <!-- Cielo y campo -->
                        <linearGradient id="sky" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="0%" stop-color="#bde3ff" />
                            <stop offset="100%" stop-color="#eaf7ff" />
                        </linearGradient>
                        <linearGradient id="ground" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="0%" stop-color="#b7e39f" />
                            <stop offset="100%" stop-color="#8fd379" />
                        </linearGradient>
                    </defs>

                    <rect x="0" y="0" width="360" height="140" fill="url(#sky)" />
                    <rect x="0" y="140" width="360" height="80" fill="url(#ground)" />
                    <g id="flowersLayer"></g>
                </svg>

                <!-- SOLO CABEZAS -->
                <div id="heads" aria-hidden="true"></div>
            </div>

            <!-- Botón de sonido + audio -->
            <button class="sound" id="sound" aria-pressed="true" title="Activar/Desactivar música">
                <span id="soundIco">🔊</span>
                <span class="dot" aria-hidden="true"></span>
            </button>
            <audio id="music" src="wawi.mp3" preload="auto" loop></audio>

            <button class="btn" id="go">🌼 Abrir sorpresa</button>
            <p class="msg" id="msg">Hoy no puedo llevarte flores en persona🥺, así que te mando este <strong>corazón de
                    flores amarillas</strong>. Gracias mi vida por iluminar mis días. Te amo mi Wawita Hermosa. 💛</p>
            <br>
            <div class="footerNote">Hecho con mucho amor • Para mi Pincesita💛</div>
        </div>
    </div>

    <script>
        const $ = (s, d = document) => d.querySelector(s);
        const btn = $('#go'), msg = $('#msg'), card = $('#card');

        function rand(a, b) { return Math.random() * (b - a) + a }
        function dropPetals(n = 40) {
            n = Math.min(n, 120);
            for (let i = 0; i < n; i++) {
                const p = document.createElement('div'); p.className = 'petal';
                const size = rand(8, 18); p.style.width = size + 'px'; p.style.height = size + 'px';
                p.style.left = rand(-10, 100) + 'vw'; p.style.background = Math.random() > .5 ? 'var(--petal)' : 'var(--petal2)';
                const fall = rand(4.5, 7.5), rot = rand(-40, 40);
                p.style.animation = `fall ${fall}s linear ${rand(0, .8)}s forwards, spin ${fall}s linear`;
                p.style.transform = `rotate(${rot}deg)`; document.body.appendChild(p);
                setTimeout(() => p.remove(), (fall + 1) * 1000);
            }
        }
        function floatHeart(el) {
            const h = document.createElement('div'); h.className = 'heart'; h.textContent = '❤';
            const r = el.getBoundingClientRect(); h.style.left = (r.left + r.width / 2 - 7) + 'px'; h.style.top = (r.top + 8) + 'px';
            h.style.color = 'var(--heart)'; document.body.appendChild(h); setTimeout(() => h.remove(), 2200);
        }

        /* ====== Campo con viento ====== */
        (function buildField() {
            const svg = document.getElementById('field');
            const layer = svg.querySelector('#flowersLayer');
            // angostar suavemente el ramo (solo escala horizontal)
            const cx = 180; // centro del viewBox (360/2)
            const kx = (window.innerWidth <= 420) ? 0.82 : 0.90; // más angosto en móvil
            layer.setAttribute('transform', `translate(${cx},0) scale(${kx},1) translate(${-cx},0)`);

            const GROUND_Y = 140, FLOWERS = 10;
            const MIN_SCALE = .75, MAX_SCALE = 1.25;

            for (let i = 0; i < FLOWERS; i++) {
                const x = 20 + (i + 0.5) * (320 / FLOWERS) + rand(-6, 6);
                const y = GROUND_Y + rand(-2, 2);
                const s = rand(MIN_SCALE, MAX_SCALE);
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.setAttribute('transform', `translate(${x}, ${y}) scale(${s})`);
                const template = document.getElementById('sunflower').cloneNode(true);
                g.appendChild(template); layer.appendChild(g);
                g.setAttribute('transform', `translate(${x}, ${y}) scale(${s})`);
                g.dataset.spin = (Math.random() * 10 + 12).toFixed(2); // 12–22 °/s por flor
            }
        })();

        (function sway() {
            const svg = document.getElementById('field');
            const groups = svg.querySelectorAll('#flowersLayer > g');
            let t = 0, gust = 0, target = 0;
            const lerp = (a, b, k) => a + (b - a) * k;

            function loop() {
                requestAnimationFrame(loop); const dt = .016; t += dt;
                if (Math.random() < dt * 0.25) target = rand(-1, 1);
                gust += (target - gust) * Math.min(1, dt * 0.6);

                const base = Math.sin(t * 0.9) * 0.6 + Math.sin(t * 0.27 + 1.1) * 0.4;
                const wind = base * 0.7 + gust * 0.6 + Math.sin(t * 3.3) * 0.05;

                groups.forEach((g, idx) => {
                    const scale = +g.getAttribute('transform').match(/scale\(([^)]+)\)/)[1];
                    const depthAtten = lerp(.8, 1.2, (scale - 0.75) / (1.25 - 0.75));
                    const sway = wind * depthAtten;
                    const deg = sway * 8 + Math.sin(t * 2 + idx) * 2;
                    const tr = g.getAttribute('transform').replace(/\s*rotate\([^)]+\)/g, '');
                    g.setAttribute('transform', tr + ` rotate(${deg})`);
                    const head = g.querySelector('#head');
                    if (head) {
                        const spin = (t * parseFloat(g.dataset.spin)) % 360;
                        head.setAttribute('transform', `translate(0,-6) rotate(${-(deg * 0.55) + spin})`);
                    }
                });
            }
            requestAnimationFrame(loop);
        })();

        /* ====== SOLO CABEZAS (corazón) ====== */
        const headsLayer = document.getElementById('heads');

        function buildHeads() {
            headsLayer.innerHTML = '';
            const N = 17; // (tu distribución actual)
            const svgNS = 'http://www.w3.org/2000/svg';

            for (let i = 0; i < N; i++) {
                const wrap = document.createElement('div');
                wrap.className = 'headWrap';
                const s = document.createElementNS(svgNS, 'svg');
                s.setAttribute('viewBox', '-26 -26 52 52');
                s.setAttribute('width', '72'); s.setAttribute('height', '72');
                const use = document.createElementNS(svgNS, 'use');
                use.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#sunflowerHead');
                s.appendChild(use);
                s.classList.add('headSpin');
                s.style.setProperty('--spinDur', (Math.random() * 6 + 12).toFixed(1) + 's');
                if (Math.random() < 0.5) s.style.animationDirection = 'reverse';
                wrap.appendChild(s); headsLayer.appendChild(wrap);
                requestAnimationFrame(() => wrap.classList.add('pop'));
            }
            setTimeout(() => morphToHeart(), 280);
        }

        function heartPoint(t) {
            return {
                x: 16 * Math.pow(Math.sin(t), 3),
                y: 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)
            };
        }

        function morphToHeart() {
            const wraps = [...headsLayer.querySelectorAll('.headWrap')];
            const rect = headsLayer.getBoundingClientRect();
            const W = rect.width, H = rect.height;

            const M = 600, pts = new Array(M);
            for (let i = 0; i < M; i++) pts[i] = heartPoint((i / M) * Math.PI * 2);
            const cum = [0]; let L = 0;
            for (let i = 0; i < M; i++) {
                const a = pts[i], b = pts[(i + 1) % M]; L += Math.hypot(b.x - a.x, b.y - a.y); cum.push(L);
            }

            const N = wraps.length;
            const step = L / N, offset = step / 2;
            const sel = []; let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;

            for (let i = 0; i < N; i++) {
                let d = offset + i * step; if (d >= L) d -= L;
                let j = 0; while (!(cum[j] <= d && d <= cum[j + 1])) j++;
                const a = pts[j], b = pts[(j + 1) % M], t = (d - cum[j]) / (cum[j + 1] - cum[j]);
                const x = a.x + (b.x - a.x) * t, y = a.y + (b.y - a.y) * t;
                sel.push({ x, y });
                if (x < minX) minX = x; if (x > maxX) maxX = x; if (y < minY) minY = y; if (y > maxY) maxY = y;
            }

            const width = maxX - minX, height = maxY - minY;
            const s = Math.min(W / width, H / height) * 0.92;
            const dx = (W - width * s) / 2, dy = (H - height * s) / 2;

            sel.forEach((p, i) => {
                const x = (p.x - minX) * s + dx;
                const y = (maxY - p.y) * s + dy;
                const jx = (Math.random() - 0.5) * 4, jy = (Math.random() - 0.5) * 4;
                const w = wraps[i];
                w.style.left = (x + jx) + 'px';
                w.style.top = (y + jy) + 'px';
            });
        }

        /* ====== Música ====== */
        const soundBtn = $('#sound');
        const soundIco = $('#soundIco');
        const music = $('#music');
        let musicStarted = false;

        function startMusic() {
            if (musicStarted) return;
            musicStarted = true;
            music.muted = false;
            music.volume = 0.0;
            music.play().then(() => {
                // fade-in
                const target = 0.45, step = 0.05;
                const id = setInterval(() => {
                    music.volume = Math.min(target, music.volume + step);
                    if (music.volume >= target) clearInterval(id);
                }, 120);
            }).catch(err => {
                // Si iOS no deja en el primer intento, se puede tocar el botón de sonido para reintentar.
                console.warn('No se pudo reproducir inmediatamente:', err);
            });
        }

        soundBtn.addEventListener('click', () => {
            const isOn = soundBtn.getAttribute('aria-pressed') === 'true';
            if (isOn) {
                // apagar
                music.muted = true;
                soundBtn.setAttribute('aria-pressed', 'false');
                soundIco.textContent = '🔇';
            } else {
                // encender
                music.muted = false;
                soundBtn.setAttribute('aria-pressed', 'true');
                soundIco.textContent = '🔊';
                if (!musicStarted) startMusic();
            }
        });

        /* ====== Click: campo -> corazón ====== */
        let opened = false;
        btn.addEventListener('click', () => {
            if (opened) return; opened = true;
            btn.disabled = true; btn.textContent = '💛 Feliz primavera';
            msg.classList.add('show'); dropPetals(70); floatHeart(btn);
            startMusic(); // ← arranca la música en interacción de usuario (compatible iOS)

            const field = document.getElementById('field');
            field.classList.add('fade-out');
            setTimeout(() => {
                field.style.display = 'none';
                buildHeads();
                headsLayer.classList.add('show');
            }, 520);
        });

        // Confeti extra
        document.addEventListener('click', e => {
            if (opened && !e.target.closest('#go')) dropPetals(18);
        }, { passive: true });

        if (window.innerHeight < 560) document.documentElement.style.fontSize = '15px';
    </script>
</body>

</html>